<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <title>GSW Math Tournament</title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="" name="keywords">
        <meta content="" name="description">
    
        <!-- Favicon -->
        <!--- <link href="/css/Templates/solartec-1.0.0/img/favicon.ico" rel="icon"> --->
    
        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500&family=Roboto:wght@500;700;900&display=swap" rel="stylesheet"> 
    
        <!-- Icon Font Stylesheet -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    
        <!-- Libraries Stylesheet -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta2/dist/css/bootstrap-select.min.css">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link href="CSS/custom.css" rel="stylesheet">
    </head>

<body>
    <!-- Topbar Start -->
    <div class="container-fluid gsw-primary p-0" style="z-index: 500;">
        <div class="row gx-0 d-none d-lg-flex">
            <div class="col-lg-7 px-5 text-start">
                <div class="h-100 d-inline-flex align-items-center me-4">
                    <small class="fa fa-map-marker-alt gsw-text-secondary me-2"></small>
                    <small class="text-white">800 Georgia Southwestern State University Dr, Americus, GA 31709</small>
                </div>
                <div class="h-100 d-inline-flex align-items-center">
                    <small class="far fa-clock gsw-text-secondary me-2"></small>
                    <small class="text-white">Mon - Fri : 08:00 AM - 05:00 PM</small>
                </div>
            </div>
            <div class="col-lg-5 px-5 text-end">
                <div class="h-100 d-inline-flex align-items-center me-4">
                    <small class="fa fa-phone-alt gsw-text-secondary me-2"></small>
                    <small class="text-white">877-871-4594</small>
                </div>
                <div class="h-100 d-inline-flex align-items-center mx-n2">
                    <a class="btn btn-square btn-link rounded-0 border-0 border-end border-secondary gsw-text-secondary" href="https://www.facebook.com/GeorgiaSouthwestern/"><i class="fab fa-facebook-f"></i></a>
                    <a class="btn btn-square btn-link rounded-0 border-0 border-end border-secondary gsw-text-secondary" href="https://twitter.com/GaSouthwestern"><i class="fab fa-twitter"></i></a>
                    <a class="btn btn-square btn-link rounded-0 border-0 border-end border-secondary gsw-text-secondary" href="https://www.linkedin.com/school/georgia-southwestern-state-university/"><i class="fab fa-linkedin-in"></i></a>
                    <a class="btn btn-square btn-link rounded-0 gsw-text-secondary" href="http://www.instagram.com/georgiasouthwestern"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </div>
    <!-- Topbar End -->

    <!-- Navbar Start -->
    <nav class="container-fluid navbar navbar-expand-lg navbar-light sticky-top p-0" style="background-color: #e3e3e3; z-index: 500;">
      <a href="index.html" class="navbar-brand mr-auto d-flex align-items-center border-end px-4 px-lg-5">
          <h2 class="m-0 gsw-text-primary">Divide-Conquer</h2>
      </a>
      <button type="button" class="navbar-toggler me-2" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
          <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarCollapse">
          <div class="navbar-nav ms-auto p-2 p-lg-0">
               <div class="nav-item dropdown">
                  <a href="" class="nav-link dropdown-toggle" style="padding-right: 150px;" data-bs-toggle="dropdown">Manage</a>
                  <div class="dropdown-menu bg-light m-0">
                      <button href="" id="myButton2" class="dropdown-item">Teams</button>
                      <button href="" id="myButton1" class="dropdown-item" style="padding-right: 150px;">School</button>
              </div>
  </nav>
  <!-- Navbar End -->
    <div class="container">
        <h1 class="gsw-text-primary" style="text-align: center; padding: 20px;">
            Edit Team Information
          </h1>                      
    </div>   
    <div class="container text-center">
    <form id="update-record-form">

        <button type="submit" class="btn btn-primary btn-outline-light gsw-secondary gsw-text-primary rounded-0 py-4 px-lg-5" style="margin-bottom: 20px;">
            Submit
        </button>
        <br>
        <label style="margin-right: 100px;">
          Student ID
        </label>
        <label style="margin-right: 100px;">
          Last Name
        </label>
        <label>
          First Name
        </label>
        <br>

    </form>

    <button id="fetch-button" class="btn btn-primary btn-outline-light gsw-secondary gsw-text-primary rounded-0 py-4 px-lg-5" style="margin-top: 20px;">Add Student<i class="fa fa-arrow-right ms-3"></i></button>

    <button id="delete-button" class="btn btn-primary btn-outline-light gsw-secondary gsw-text-primary rounded-0 py-4 px-lg-5" style="margin-top: 20px;">Delete Team<i class="fa fa-arrow-right ms-3"></i></button>


  </div>
  <!-- JavaScript code -->
  <script>
    var queryString = window.location.search;
    var urlParams = new URLSearchParams(queryString);
    var id = urlParams.get('ID1');
    var id2 = urlParams.get('ID');

    const myButton2 = document.getElementById('myButton2');
const myButton1 = document.getElementById('myButton1');
const addStudent = document.getElementById('fetch-data');

myButton2.onclick = function() {
  window.location.href = `/view_teams.html?ID=${id}`;
};

myButton1.onclick = function() {
  window.location.href = `/school.html?ID=${id}`;
};

    const url2 = `https://math.gswcm.net:443/JS/get_school?variable=${id}&ID=${id2}`;
      fetch(url2)
      .then(response => response.json())
      .then(data => {    
        const PK = data[0].SchoolPK

        const fetchButton = document.querySelector('#fetch-button');
  fetchButton.addEventListener('click', fetchData);


        function fetchData() {

          const formData = new FormData(form1);
const formEntries = formData.entries();

          const result = [];
let currentObj = {};
for (const [key, value] of formEntries) {
  if (key === 'field') {
    // Start a new object
    currentObj = {};
    result.push(currentObj);
  }
  currentObj[key] = value;
}

const jsonString = JSON.stringify(result);
console.log(jsonString);
location.reload(true);

          fetch(`https://math.gswcm.net:443/JS/update_team`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: jsonString
    })
    .then(response => response.text())
    
    .then(data => {
      console.log(data); // outputs "User updated"
      

    })
    .catch(error => {
      console.error(error);
    });

    fetch(`https://math.gswcm.net:443/JS/add_student`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
    school: PK,
    team: id2
    }) 
  })
    .then(response => response.text())
    .then(data => {
      if(data == "overeight"){
        alert("You can not have more than 8 students in a team. Please make a new team.")
      }else{
        console.log(data); // outputs "User updated"
        location.reload(true);
      }
    })
    .catch(error => {
      console.error(error);
    })
  }

  const deleteButton = document.querySelector('#delete-button');
  deleteButton.addEventListener('click', deleteTeam);

  function deleteTeam() {
          console.log(PK)
    fetch(`https://math.gswcm.net:443/JS/delete_team`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
    school: PK,
    team: id2
    }) 
  })
    .then(response => response.text())
    .then(data => {
      console.log(data); // outputs "User updated"
    })
    .catch(error => {
      console.error(error);
    });
    window.location.href = `/view_teams.html?ID=${id}`
  }

  const myVariable = data[0].SchoolPK;
const url = `https://math.gswcm.net:443/JS/team?variable=${myVariable}&team=${id2}`;

const url2 = `https://math.gswcm.net:443/JS/update_team?variable=${myVariable}&team=${id2}`;


      fetch(url)
  .then(response => response.json())
  .then(data => {
    // 5. Parse the JSON response and use the data to generate the form dynamically
    const form = document.getElementById('update-record-form');
    var i = 0
    data.forEach(item => {
      i = i + 1

      const field = document.createElement('input');
      field.type = 'text';
      field.name = 'field';
      field.value = i;
      form.appendChild(field);
      field.readOnly = true;
      
      const field1 = document.createElement('input');
      field1.type = 'text';
      field1.name = 'field1';
      field1.value = item.StudentPK;
      form.appendChild(field1);
      field1.readOnly = true;

      const field2 = document.createElement('input');
      field2.type = 'text';
      field2.name = 'field2';
      field2.value = item.StudentLName;
      form.appendChild(field2);

      const field3 = document.createElement('input');
      field3.type = 'text';
      field3.name = 'field3';
      field3.value = item.StudentFName;
      form.appendChild(field3);

      const deleteButton1 = document.createElement('a');
      deleteButton1.type='button';
      deleteButton1.classList.add('btn','btn-primary','btn-outline-light','gsw-secondary','gsw-text-primary','rounded-0')
  deleteButton1.textContent = 'Delete';
  deleteButton1.addEventListener('click', () => {
    const studentPK = item.StudentPK 

    // Send data to server
    fetch('https://math.gswcm.net:443/JS/delete_student', {
      method: 'POST',
      body: JSON.stringify({ studentPK }),
      headers: { 'Content-Type': 'application/json' }
    })
      
    .then(response => {
    })
    .catch(error => {
      console.error('Error:', error);
    });
    location.reload(true);
  });
  form.appendChild(deleteButton1)

      const lineBreak = document.createElement('br');
      form.appendChild(lineBreak);
    });
  })
  .catch(error => console.error(error));

  const form1 = document.getElementById('update-record-form');

form1.addEventListener('submit', (event) => {
  event.preventDefault(); // prevent the default form submission behavio
  const formData = new FormData(form1);
const formEntries = formData.entries();

const result = [];
let currentObj = {};
for (const [key, value] of formEntries) {
  if (key === 'field') {
    // Start a new object
    currentObj = {};
    result.push(currentObj);
  }
  currentObj[key] = value;
}

console.log(result)

const jsonString = JSON.stringify(result);
console.log(jsonString);
location.reload(true);
alert('Updated')

// replace with the actual ID of the user to update
fetch(`https://math.gswcm.net:443/JS/update_team`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: jsonString
  })
    .then(response => response.text())
    
    .then(data => {
      console.log(data); // outputs "User updated"
      

    })
    .catch(error => {
      console.error(error);
    });
    const foward = `https://math.gswcm.net/view_team.html?ID1=${id2}&ID=${id}`
    window.location.replace(foward)
});
      })

  </script>
        

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta2/dist/js/bootstrap-select.min.js"></script>
</body>

</html>